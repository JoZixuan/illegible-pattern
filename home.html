<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Illegible Pattern</title>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas-add-mix-blend-mode@1.4.1/dist/html2canvas.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script> -->
    <!-- <script src="sketch.js"></script> -->
    <link rel="stylesheet" href="styles.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100..900&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
  <script src="iro.min.js"></script>
  <!-- <script src="script.js"></script> -->
</head>
<body> 


    <div class="button-container">
       
        
            <!--  第1个按钮：About page pop-up -->
         <button id="about"> ? </button>  

            <!--  第2个按钮：Glyphs Chart -->
         <button id="chart"> ! </button>  
         
            <!--  第3个按钮：Change Shape font to Authentic Sans -->
         <button id="meaning" >字</button>


            <!--  4：Change multiply color to solid color -->
         <button id="color-mode" class="styled-button darkblueback"></button>  


            <!--  5：Greyscale Button -->
        <button id="greyscale" class="styled-button inkback"></button>  


             <!--  6：Text Alignment button-->
         <button id="text-alignment" class="styled-button yellowback"></button> 

          
         <!-- REM Size Slider -->
        <div class="slider-group">
            <label for="rem-slider"></label>
            <input type="range" id="rem-slider" min="0.5" max="20" step="0.1" value="1">
        </div>

        <!-- H1 Size Slider -->
        <div class="slider-group">
            <label for="h1-slider"></label>
            <input type="range" id="h1-slider" min="5" max="100" step="1" value="16">
        </div>

        <!-- H2 Size Slider -->
        <div class="slider-group">
            <label for="h2-slider"></label>
            <input type="range" id="h2-slider" min="10" max="100" step="1" value="32">
        </div>

        <!-- Line-height Slider vertical spacing -->
        <div class="slider-group">
        <label for="line-height-slider"></label>
        <input type="range" id="line-height-slider" min="0.1" max="3" step="0.01" value="1">
        </div>

        <!-- letter spacing Slider horizontal spacing -->
        <div class="slider-group">
            <label for="letter-spacing-slider"></label>
            <input type="range" id="letter-spacing-slider" min="-30" max="300" step="1" value="0">
            </div>

         <!--  7: Import image as background-->
        <button id="import" class="darkblueback"></button>  


          <!-- 8：SVG Download button-->
            <!-- <button id="save-svg-btn" class="styled-button skyblueback"></button>    -->
        
        <!--  9：PNG Download button-->
         <button id="save-png-btn" class="yellowback"></button> 

          <!-- Reset Button -->
        <!-- <button class="reset-button"></button>   -->

        <button id="delete"><img src="delete.svg" /></button> 
        <!-- 10: Advance Mode Button -->
<button id="advance-mode-btn">!
</button>
    </div>


 <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!! Content starts here !!!!!!!!!!!!!!!!!!!!!!!!!!!-->
 <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!! Content starts here !!!!!!!!!!!!!!!!!!!!!!!!!!!-->
 <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!! Content starts here !!!!!!!!!!!!!!!!!!!!!!!!!!!-->
     
 <!-- A BIG CONTAINER -->

    <div id="blended-content" class="container">

         <!-- Pattern 001 -->

         <div class="drag-wrapper box1" tabindex="0">
            <div class="drag-box">
                <p class="textstyle1">
WaWaWaWaWaWaWaWaWaWaWaWaWaWaWWaWaWaWaWaWaWaWaWaWaWaWaWaWaWWaWaWaWaWaWaWaWaWaWaWaWaWaWaWWaWaWaWaWaWaWaWaWaWaWaWaWaWaWWaWaWaWaWaWaWaWaWaWaWaWaWaWaWWaWaWaWaWaWaWaWaWaWaWaWaWaWaWWaWaWaWaWaWaWaWaWaWaWaWaWaWaWWaWaWaWaWaWaWaWaWaWaWaWaWaWaW</p> </div>
<div class="resize-handle"></div>
            </div>
         


       <div class="drag-wrapper box2" tabindex="0">
        <div class="drag-box">  <p class="textstyle2"> kkkkkijijiijiaiiijjjjjiiijijjijiijkkkkkkkkakkkkkkkkaYZ56656kjkk561234563157461a234563157432156413245412663215641327461a234563145k4126jijiijkkakiiiikaijijjjjijj  </p> </div>
        <div class="resize-handle"></div></div>

      

          <!-- Pattern 003 -->

    <div class="drag-wrapper box3" tabindex="0">
        <div class="drag-box">
        <p class="red redtextsetting" >
            AEFGnoSklmyWYXGZkZWWZWXG
    </p> </div>
    <div class="resize-handle"></div></div>
   

         <!-- Pattern 004 -->
        
        <div class="drag-wrapper box4" tabindex="0">
            <div class="drag-box">
            <p class="h2"> 
            QRSRQSRSSSRQSQRSQRSQQRASQRASRQRASRQRASASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQQRSQRSQQRASQRASRQRASRQRQRQSRSQRQSRQSRQRQRASQRASRQRASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRQRASQRASRQRASRQRQRQSRSQRQSRQSRSRQSRSSSRQSQRSQRSQQRASQRASRQRSRSQRQSRQSRQRSRQSRSSSRQSQRSQQRSRQSRSSSRQSQRSQRSQQRASQRASRQRASRQRASASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQQRSQRSQQRASQRASRQRASRQRQRQSRSQRQSRQSRQRQRASQRASRQRASRQRQRQSRSQRQSRQSRRASQRASRQRASRQRASASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQQRASQRASRQRASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQQRASQRASRQRASRQRQRQSRSQRQSRQSRQSSSRQSQRSQRSQQRASQRASRQRASRQRASRSRRRAAAASRSRRARARARAARRRSSSSSAAAQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQRSQQRASQRASRQRASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQQRASQRASRQRASRQRASASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRRSQQRASQRASRQRASRQRASRSRRRAAAASRSRRARARARAARRRSSSSSAAAQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQRSQQRASQRASRQRASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQQRASQRASRQRASRQRASASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQQRASQRASRQRASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQQRASQRASRQRASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQQRASQRASRQRASRQRASQRASRQRASRQRASASRQRQRQSRSQRQSRQSRQRSRQSRSSSRQSQRSQRSQQRASQRASRQRASRQRQRQSRSQRQSRQSRQR   </p></div>
             <div class="resize-handle"></div>
        </div>

                  <!-- Pattern 005 -->

            <div class="drag-wrapper box5" tabindex="0">
                <div class="drag-box">
                <p class= "green greentextsetting"> 
                    AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
                </p></div>
                <div class="resize-handle"></div>
            </div>

              <!-- 黄色方格 -->
            <!-- <div class="drag-wrapper box6" tabindex="0"> 
                <div class="drag-box"> 
                <p class="textsetting6"> WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW  </p></div>
                 <div class="resize-handle"></div>
                </div> -->

           
              <!-- Pattern 007 -->
            <div class="drag-wrapper box7" tabindex="0">
                <div class="drag-box">
                <p class= "pinktextsetting"> FLFLFLFLFLFLFLFLFLFLFLFLFLFLFLFLFLFFLFLFLFLFLFLFLFFLFLFLFLFLFLFLFFLFLFLFLFLFLFLrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsryyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyysrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsrsLFLFLFLFLFLFLFLFLFLFLFFLFLFLFLFLFLFLFFLFLFLFLFLFLFLFFLFLFLFLF</p></div>
                <div class="resize-handle"></div>
            </div>

             <!-- Pattern 008 -->
        
    <div class="drag-wrapper box8" tabindex="0">
        <div class="drag-box">
        <p class="textsetting8 skyblue "> 
            0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0EzozozozozozozozozozozozozozozozozoAIAIAIAIAIAIAIAIAIAAIIAIIAIAIAIAIAI
    </p></div>
    <div class="resize-handle"></div>
    </div>



        
 <!-- section 4 -->
        <div class="drag-wrapper box9" tabindex="0">
            <div class="drag-box">
            <p class=" ink">aaaaaaaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p></div>
            <div class="resize-handle"></div></div>
    </div>   
    <!---------- CONTAINER END ------->

    
    <script>


//loading animation
const loader = document.getElementById('loader');
    const textEl = document.getElementById('loading-text');
    const fullText = '...loading ILLEGIBLE PATTERN';
    const staticIndices = [0,1,2,10,19]; // "...", and spaces at positions 10 and 19
    const textChars = fullText.split('');

    function randomChar() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890';
      return chars[Math.floor(Math.random() * chars.length)];
    }

    async function animateLoader() {
      // 0.2s: Fade in grey bar
      await new Promise(resolve => setTimeout(() => {
        loader.style.opacity = 1;
        resolve();
      }, 200));

      // 0.2s–2s: Typewriter effect
      for (let i = 0; i < textChars.length; i++) {
        await new Promise(r => setTimeout(r, (600 / textChars.length)));
        textEl.textContent += textChars[i];
        if (textEl.textContent.endsWith("loading")) {
          await new Promise(r => setTimeout(r, 400));
        }
         if (textEl.textContent.endsWith("ILLEGIBLE")) {
          await new Promise(r => setTimeout(r, 400));
        }
      }

      textEl.style.opacity = 0.3;
      await new Promise(r => setTimeout(r, 80));
      textEl.style.opacity = 1;
      await new Promise(r => setTimeout(r, 500));
     
      // 2s–4s: Start characters randomizing one by one from left to right, then let them all keep changing independently
      const activeText = textEl.textContent.split('');
      const animatingIndices = [];

      // Launch each character's randomizer one by one
      for (let i = 0; i < textChars.length; i++) {
        if (!staticIndices.includes(i)) {
          setTimeout(() => {
            animatingIndices.push(i);
          }, i * 20); // stagger each start by 40ms from left to right
        }
      }

      // Continuously update any started characters
      for (let t = 0; t < 50; t++) {
        await new Promise(r => setTimeout(r, 40)); // refresh rate for visible glitching
        for (let i of animatingIndices) {
          activeText[i] = randomChar();
        }
        textEl.textContent = activeText.join('');

        // At halfway point (after ~2s), change to ShapeFont
        if (t === 30) textEl.style.fontFamily = 'shape-font';
      }      

      // 3s–4s: Continue randomizing (excluding static ones)
      for (let i = 0; i < textChars.length; i++) {
        if (staticIndices.includes(i)) continue;
        await new Promise(r => setTimeout(r, (500 / textChars.length)));
        const current = textEl.textContent.split('');
        // for (let j = 0; j < 2; j++) {
        //   current[i] = randomChar();
        //   textEl.textContent = current.join('');
        //   await new Promise(r => setTimeout(r, 20));
        // }
        textEl.textContent = current.join('');
      }

   await new Promise(r => setTimeout(r, 100));
      // Final flicker of container
      textEl.style.opacity = 0.3;
      await new Promise(r => setTimeout(r, 100));
      textEl.style.opacity = 1;
      await new Promise(r => setTimeout(r, 100));
      textEl.style.opacity = 0;
      await new Promise(r => setTimeout(r, 200));
      

      // Hide loader and show main content
      loader.style.opacity = 0;
      await new Promise(r => setTimeout(r, 100));
      document.getElementById('loader-wrapper').style.display = 'none';
    }

    window.addEventListener("pageshow", function (event) {
  const loaderWrapper = document.getElementById("loader-wrapper");
 
  // Show loader wrapper by default
  loaderWrapper.style.display = "flex";
 
  console.log("pageshow triggered");
  console.log("event.persisted:", event.persisted);
  console.log("sessionStorage loaderPlayed:", sessionStorage.getItem("loaderPlayed"));
 
  // Skip loader if navigating back or loader already played
  if (event.persisted || performance.getEntriesByType("navigation")[0].type === "back_forward" || sessionStorage.getItem("loaderPlayed")) {
    console.log("Skipping loader");
    loaderWrapper.style.display = "none";
  } else {
    console.log("Playing loader");
    animateLoader().then(() => {
      sessionStorage.setItem("loaderPlayed", "true");
    });
  }
});
    //animation ends

        const remSlider = document.getElementById("rem-slider");
        const h1Slider = document.getElementById("h1-slider");
        const h2Slider = document.getElementById("h2-slider");
        // const resetButton = document.querySelector(".reset-button");

        // Random color generator
        function getRandomColor() {
            return `rgb(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)})`;
        }

        // Update REM size and change color dynamically
        remSlider.addEventListener("input", function () {
            document.documentElement.style.setProperty("--rem-size", this.value + "rem");
            document.documentElement.style.setProperty("--rem-color", getRandomColor());
        });

        // Update H1 size and change color dynamically
        h1Slider.addEventListener("input", function () {
            document.documentElement.style.setProperty("--h1-size", this.value + "px");
            document.documentElement.style.setProperty("--h1-color", getRandomColor());
        });

        // Update H2 size and change color dynamically
        h2Slider.addEventListener("input", function () {
            document.documentElement.style.setProperty("--h2-size", this.value + "px");
            document.documentElement.style.setProperty("--h2-color", getRandomColor());
        });


        ///// Reset Button Functionality currentl commented out///////
        // resetButton.addEventListener("click", function () {
        //     // Reset slider values
        //     remSlider.value = "1";
        //     h1Slider.value = "16";
        //     h2Slider.value = "32";

        //     document.documentElement.style.setProperty("--rem-size", "1rem");
        //     document.documentElement.style.setProperty("--h1-size", "16px");
        //     document.documentElement.style.setProperty("--h2-size", "32px");

        //     document.documentElement.style.setProperty("--rem-color", "blue");
        //     document.documentElement.style.setProperty("--h1-color", "red");
        //     document.documentElement.style.setProperty("--h2-color", "green");

        //     // Reset all <p> styles
        //      document.querySelectorAll("p").forEach(p => {
        //     p.style.lineHeight = "";
        //     p.style.letterSpacing = "";
        //     p.style.fontFamily = "shape-font";
        //     p.style.textAlign = "left";
        //     p.style.mixBlendMode = "multiply";
        //     p.style.filter = "none";
        //     p.style.opacity = "1";
        //     p.classList.remove("shap-4");
        //  });

        //     // Reset slider visuals
        //     sliders.forEach(slider => {
        //         updateSliderBackground(slider);
        //     });
        // });

        // Function to update the slider background
           function updateSliderBackground(slider) {
            let value = slider.value; // Get slider value
            let min = slider.min;
            let max = slider.max;
            let percentage = ((value - min) / (max - min)) * 100;

            // 🎨 Left side = Blue (#34d3ff), Right side = Yellow (#fff04b)
            slider.style.background = `linear-gradient(to right, #34d3ff 0%, #34d3ff ${percentage}%, #fff04b ${percentage}%, #fff04b 100%)`;
        }

        // Get all sliders
        const sliders = document.querySelectorAll("input[type='range']");

        // Add event listener to each slider
        sliders.forEach(slider => {
            slider.addEventListener("input", function () {
                updateSliderBackground(this);
            });

            // Initialize the background on page load
            updateSliderBackground(slider);
        });

        const lineHeightSlider = document.getElementById("line-height-slider");

        // Update line-height dynamically
        lineHeightSlider.addEventListener("input", function () {
            document.documentElement.style.setProperty("--line-height", this.value);
            document.querySelectorAll("p").forEach(p => {  
                p.style.lineHeight = this.value;
            });
        });

    // Update letter spacing dynamically
        const letterSpacingSlider = document.getElementById("letter-spacing-slider");

    letterSpacingSlider.addEventListener("input", function () {
    const percentage = this.value;
    const emValue = percentage / 100;
    document.querySelectorAll("p").forEach(p => {
        p.style.letterSpacing = `${emValue}em`;
    });
});

// SVG FUNCTION!!
//         document.getElementById("save-svg-btn").addEventListener("click", saveAsSVG);

// function saveAsSVG() {
//     let targetElement = document.querySelector("#blended-content"); // Update this ID to match your content
    
//     let rect = targetElement.getBoundingClientRect();
// let width = rect.width;
// let height = rect.height;

//     // Create a canvas
//     let canvas = document.createElement("canvas");
//     canvas.width = width;
//     canvas.height = height;
//     let ctx = canvas.getContext("2d");
// targetElement.offsetHeight; // forces reflow

// // Force repaint on draggable elements by flattening styles
// document.querySelectorAll(".drag-wrapper").forEach(el => {
//     const computedStyle = window.getComputedStyle(el);
//   el.style.left = computedStyle.left;
//   el.style.top = computedStyle.top;
//   el.style.transform = "none"; // Disable transform
// });

// // Force reflow
// targetElement.offsetHeight;
//     // Use html2canvas to capture blended content
//     html2canvas(targetElement, {
//         backgroundColor: null,
//         useCORS: true
//     }).then(canvas => {
//         let imgData = canvas.toDataURL("image/png");

//         // Wrap image in SVG
//         let svgContent = `
//         <svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">
//             <image href="${imgData}" width="${width}" height="${height}" />
//         </svg>`;

//         let blob = new Blob([svgContent], { type: "image/svg+xml;charset=utf-8" });
//         let url = URL.createObjectURL(blob);

//         let a = document.createElement("a");
//         a.href = url;
//         a.download = "blended-output.svg";
//         a.click();
//         URL.revokeObjectURL(url);
//     });
// }

///////////  SAVE PNG function /////////
document.getElementById("save-png-btn").addEventListener("click", saveAsPNG);

function saveAsPNG() {
    let targetElement = document.querySelector(".container"); // Adjust selector if needed

// Force repaint on draggable elements by flattening styles
document.querySelectorAll(".drag-wrapper").forEach(el => {
    const computedStyle = window.getComputedStyle(el);
  el.style.left = computedStyle.left;
  el.style.top = computedStyle.top;
  el.style.transform = "none"; // Disable transform
});

// Force reflow
targetElement.offsetHeight;
    html2canvas(targetElement, {
        backgroundColor: null,
        useCORS: true
    }).then(canvas => {
        let a = document.createElement("a");
        a.href = canvas.toDataURL("image/png");
        a.download = "blended-output.png";
        a.click();
    }).catch(error => {
        console.error("Error capturing content:", error);
    });
}

//advance mode popup
     
document.getElementById("advance-mode-btn").addEventListener("mouseover", function (event) {
    console.log("Hovered over advance-mode-btn");

    let popup = document.getElementById("advance-warning");
    if (!popup) {
        popup = document.createElement("div");
        popup.id = "advance-warning";
        popup.innerHTML = `<p style="font-family: authentic-sans-90; font-size= 50px;mix-blend-mode: normal;">Really for the advance mode?<br/>You'll have more fun in the next page!</p>`;
        popup.style.width = "350px";
        popup.style.height = "120px";
        popup.style.position = "fixed";
        popup.style.display = "flex";
        popup.style.justifyContent ="center";
        popup.style.alignItems = "center";
        popup.style.textAlign = "center";
        popup.style.lineHeight= "150%";
        popup.style.background = "#ff489a";
        popup.style.mixBlendMode = "solid";
        // popup.style.color = "black";
        popup.style.border = "5px solid rgb(255, 240, 75)";
        popup.style.borderRadius = "25px";
        popup.style.zIndex = "1000";
        popup.style.pointerEvents = "none";
        popup.style.top = "50%";
                popup.style.left = "50%";
                popup.style.transform = "translate(-50%, -50%)";
        //  // Dynamically position the popup below the button
        // const rect = event.target.getBoundingClientRect();
        // popup.style.top = `${rect.bottom + window.scrollY + 25}px`;
        // popup.style.left = `${rect.left + window.scrollX - 300}px`;
        document.body.appendChild(popup);
    }
});

document.getElementById("advance-mode-btn").addEventListener("mouseleave", function () {
    const popup = document.getElementById("advance-warning");
    if (popup) {
        popup.remove();
    }
});
        //////////////////////////////////////////////////////////////////////////////////////////////
     ///----------------- [  ABOUT PAGE _ Pop-Up Window  ] -----------------///////////////////////////////

        document.getElementById("about").addEventListener("click", function () {
            let popup = document.getElementById("about-popup");

            if (!popup) {
                popup = document.createElement("div");
                popup.id = "about-popup";
                popup.style.position = "fixed";
                popup.style.width = "500px";
                popup.style.maxHeight = "500px"; // Set max height
                popup.style.overflow = "auto"; // Enable scroll bar when content is too long
                popup.style.height = "auto";
                popup.style.background = "#ff489a";
                popup.style.color = "back";
                popup.style.fontFamily = "authentic-sans-90"
                popup.style.lineHeight = "120%"
                popup.style.padding = "20px";
                popup.style.textAlign = "left";
                popup.style.top = "50%";
                popup.style.left = "50%";
                popup.style.outline = "5px solid #fff04b";
                popup.style.transform = "translate(-50%, -50%)";
                popup.style.zIndex = "1000";
                popup.innerHTML = `
<span id="close-popup" style="
          position: absolute;
          top: 15px;
          right: 15px;
          cursor: pointer;
          font-size: 20px;
          font-weight: 100;">

          ✕
          
          </span>
          
     <p class="pop-up" style="margin-bottom: 20px;"><span style="font-family: authentic-sans-130;">ABOUT</span></p>
       <p class="pop-up" style="margin-bottom: 20px;"><span style="font-family: authentic-sans-130;">Illegible Pattern</span> is a web tool for generating geometric patterns using an illegible typeface.</p>
             <p class="pop-up" style="text-indent: 80px; margin-bottom: 20px;  text-decoration:underline;text-underline-offset: 3px;">Double click to edit the text in the patterns<br></p>
                <p class="pop-up" style=" margin-bottom: 20px;"> A custom variable font, Modular Shapes, was designed for this project. It includes a variable axis of shape, allowing
users to choose from a range rectangular or circular forms.By stripping away the semantic meaning of each letter, every glyph becomes a building block within the system. Through customization of font size, leading (line-height), kerning (letter-spacing), alignment, vertical scale, slant, and color, designers can intuitively generate pattern compositions using
traditional typesetting methods.</p>
                    <p class="pop-up" > Share your illegible pattern at this <a href="https://www.are.na/jo-zixuan/illegible-pattern" target="_blank">are.na</a> channel. <br>Designed and coded by Jo Zixuan in 2025 @RISD GD MFA</p>
  `;
                document.body.appendChild(popup);

                document.getElementById("close-popup").addEventListener("click", function () {
                    popup.remove();
                });
            } else {
                popup.remove();
            }
        });

///////////////------- [  GLYPHS CHART _ Pop-Up Window  ] ---------------- //////////////////////////////////////////////////////////////////////////-->
document.getElementById("chart").addEventListener("click", function () {
            let popup = document.getElementById("chart-popup");

            if (!popup) {
                popup = document.createElement("div");
                popup.id = "chart-popup";
                popup.style.position = "fixed";
                popup.style.width = "600px";
                popup.style.maxHeight = "390px"; // Set max height
                popup.style.overflow = "auto"; // Enable scroll bar when content is too long
                popup.style.height = "auto";
                popup.style.background = "#3fbd48";
                popup.style.color = "black";
                popup.style.fontFamily = "authentic-sans-90"
                popup.style.fontSize = "13px"
                popup.style.letterSpacing = "111%"
                popup.style.color = "white"
                popup.style.lineHeight = "120%"
                popup.style.padding = "20px";
                popup.style.paddingRight = "30px";
               
                popup.style.textAlign = "left";
                popup.style.outline = "5px solid #fff04b";
                popup.style.bottom = "0%";
                popup.style.left = "0%";
                // popup.style.top = "50%";
                // popup.style.left = "50%";
                // popup.style.transform = "translate(-50%, -50%)";
                popup.style.zIndex = "1000";
                popup.innerHTML = `
      <span id="close-popup" style="
          position: absolute;
          top: 10px;
          right: 15px;
          cursor: pointer;
          font-size: 20px;
          font-weight: 100;">

          ✕
          
          </span>
          
      <p class="pop-up" style="margin-bottom: 5px;mix-blend-mode:normal;">Rectangular mode</p>
      <img src="rectangular-chart.svg" alt='Chart explaining what the abstract shapes' correspoding keyboard input style=" width:600px;mix-blend-mode: normal;">
      <p class="pop-up" style="margin-top: 10px;margin-bottom: 5px;mix-blend-mode:normal">Circular mode</p>
      <img src="circular-chart.svg" alt='Chart explaining what the abstract shapes' correspoding keyboard input style=" width:600px;mix-blend-mode: normal;">
  `;
                document.body.appendChild(popup);

                document.getElementById("close-popup").addEventListener("click", function () {
                    popup.remove();
                });
            } else {
                popup.remove();
            }
        });


//  //////////////////////////////////////
// -------------------- [  Toggle between Shape and Meaning  ] ---------------- //////////////////////////////////////////////////////////////////////////-->
    

document.getElementById("meaning").addEventListener("click", function () {
    let paragraphs = document.querySelectorAll("p");
    paragraphs.forEach(p => {
        let currentFont = window.getComputedStyle(p).fontFamily;
        if (currentFont.includes("shape-font")) {
            p.style.fontFamily = "authentic-sans-130";
        } else {
            p.style.fontFamily = "shape-font";
        }
    });
});




//  ///////////////////////////////////
// -------------------- [  Toggle between Multiply and Solid  ] ---------------- //////////////////////////////////////////////////////////////////////////-->
    
document.getElementById("color-mode").addEventListener("click", function () {
    let paragraphs = document.querySelectorAll("p");
    paragraphs.forEach(p => {
        let currentBlendMode = window.getComputedStyle(p).mixBlendMode;
        if (currentBlendMode === "multiply") {
            p.style.mixBlendMode = "normal";
        } else {
            p.style.mixBlendMode = "multiply";
        }
    });
});

        ////////////////////////
        //   --------     Function to play sound     --------  //////////////

        function playSound(soundFile) {
            let audio = new Audio(soundFile);
            audio.play();
        }

        // Assign different sounds to buttons
        // document.getElementById("save-svg-btn").addEventListener("click", function () {
        //     playSound("audio/button1.wav");
        // });

        document.getElementById("save-png-btn").addEventListener("click", function () {
            playSound("audio/button2.wav");
        });

        document.getElementById("chart").addEventListener("click", function () {
            playSound("audio/button3.wav");
        });

        document.getElementById("about").addEventListener("click", function () {
            playSound("audio/button4.wav");
        });

        document.getElementById("meaning").addEventListener("click", function () {
            playSound("audio/button5.wav");
        });

        document.getElementById("color-mode").addEventListener("click", function () {
            playSound("audio/button6.wav");
        });
        document.getElementById("greyscale").addEventListener("click", function () {
            playSound("audio/button7.wav");
        });
        
        document.getElementById("text-alignment").addEventListener("click", function () {
            playSound("audio/alignment-audio.wav");
        });


        document.getElementById("delete").addEventListener("click", function () {
            playSound("audio/button8.wav");
            if (currentSelection) {
                currentSelection.remove();
                currentSelection = null;
            }
        });

        // Play sound effect when slider thumb is released
        document.querySelectorAll("input[type='range']").forEach(slider => {
            slider.addEventListener("change", function () {
                playSound("audio/click3.wav");
            });
        });


//  <!-- SHAP Variable Axis changes when clicked -->
//   <!-- toggle between shap 1 rectangular  & 4 circular -->
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("p").forEach(p => {
        p.addEventListener("click", function () {
            this.classList.toggle("shap-4"); // Toggle the class
        });
    });
});


//________________________<< Import Image as background  >>__________________
// _____________________________________________________________________
document.addEventListener("DOMContentLoaded", () => {
    const fileInput = document.createElement("input");
    fileInput.type = "file";
    fileInput.accept = "image/*";
    fileInput.style.display = "none"; // Keep it hidden, but accessible via button

    // Append file input to body
    document.body.appendChild(fileInput);

    // Get the import button
    const importButton = document.getElementById("import");

    // Click event to trigger file selection
    importButton.addEventListener("click", () => {
        fileInput.click();
    });

    // Handle file selection
    fileInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.body.style.backgroundImage = `url('${e.target.result}')`;
                document.body.style.backgroundSize = "100vw auto";
                document.body.style.backgroundPosition = "top center";
                document.body.style.backgroundRepeat = "no-repeat";
            };
            reader.readAsDataURL(file);
        }
    });

    // Drag and Drop functionality
    document.body.addEventListener("dragover", (event) => {
        event.preventDefault();
        document.body.style.opacity = "0.8";
    });

    document.body.addEventListener("dragleave", () => {
        document.body.style.opacity = "1";
    });

    document.body.addEventListener("drop", (event) => {
        event.preventDefault();
        document.body.style.opacity = "1";

        const file = event.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.body.style.backgroundImage = `url('${e.target.result}')`;
                document.body.style.backgroundSize = "100vw auto";
                document.body.style.backgroundPosition = "top center";
                document.body.style.backgroundRepeat = "no-repeat";
            };
            reader.readAsDataURL(file);
        }
    });
});

//________________________<< Greyscale Function button >>_________________________ _____________________________________________________________________

document.addEventListener("DOMContentLoaded", () => {
    const greyscaleButton = document.getElementById("greyscale");
    let isGreyscale = false;

    greyscaleButton.addEventListener("click", () => {
        isGreyscale = !isGreyscale;
        document.querySelectorAll("p").forEach(p => {
            if (isGreyscale) {
                p.style.filter = "grayscale(100%)"; // Apply greyscale
                p.style.opacity = "0.6"; // Reduce opacity slightly for effect
            } else {
                p.style.filter = "none"; // Remove greyscale
                p.style.opacity = "1"; // Restore full opacity
            }
        });
    });
});

//________________________<< Text Alignment Function button >>_________________________ _____________________________________________________________________

document.addEventListener("DOMContentLoaded", () => {
    const textAlignmentButton = document.getElementById("text-alignment");
    const alignments = ["left", "center", "right"];
    let currentAlignmentIndex = 0;

    textAlignmentButton.addEventListener("click", () => {
        currentAlignmentIndex = (currentAlignmentIndex + 1) % alignments.length;
        document.querySelectorAll("p").forEach(p => {
            p.style.textAlign = alignments[currentAlignmentIndex];
        });
    });
});



// TRYING JQuery drag edit and resize

$(document).ready(function () {
      $(".drag-wrapper").each(function () {
        const $wrapper = $(this);
        const $box = $wrapper.find(".drag-box");
        const $handle = $wrapper.find(".resize-handle");

        $wrapper.draggable({
  containment: "#blended-content",
  stop: function(event, ui) {
    // On stop, apply absolute positioning instead of transform
    $wrapper.css({
      left: ui.position.left,
      top: ui.position.top,
      transform: "none"
    });
  }
});

        $box.on("dblclick", function () {
          $box.attr("contenteditable", true).focus();
          $wrapper.draggable("disable");
        });

        $box.on("blur", function () {
          $box.removeAttr("contenteditable");
          $wrapper.draggable("enable");
        });

        let isResizing = false;
        let startX, startY, startWidth, startHeight;

        $handle.on("mousedown", function (e) {
          e.preventDefault();
          e.stopPropagation();

          isResizing = true;
          startX = e.clientX;
          startY = e.clientY;
          startWidth = $wrapper.outerWidth();
          startHeight = $wrapper.outerHeight();

          $wrapper.draggable("disable");

          $(document).on("mousemove.boxResize", function (e) {
            if (!isResizing) return;
            let newWidth = startWidth + (e.clientX - startX);
            let newHeight = startHeight + (e.clientY - startY);
            $wrapper.css({ width: newWidth + "px", height: newHeight + "px" });
          });

          $(document).on("mouseup.boxResize", function () {
            isResizing = false;
            $(document).off(".boxResize");
            $wrapper.draggable("enable");
          });
        });
      });
    });

    ///// 按钮跳转到advance mode .////
    document.getElementById("advance-mode-btn").addEventListener("click", function () {
    window.location.href = "advance.html";
});

 ///this goes at the end to play the animation when the user closes the tab or refreshes the page manually
 window.addEventListener("beforeunload", function () {
  sessionStorage.removeItem("loaderPlayed");
});



// Listen for clicks on any .drag-wrapper //Track current selection
let currentSelection = null;
document.querySelectorAll(".drag-wrapper").forEach(wrapper => {
    wrapper.addEventListener("click", function () {
        if (currentSelection) {
            currentSelection.classList.remove("selected");
        }
        currentSelection = this;
        currentSelection.classList.add("selected");
    });
});
document.addEventListener("click", function (event) {
    // If the clicked element is NOT inside a .drag-wrapper
    if (!event.target.closest(".drag-wrapper")) {
        if (currentSelection) {
            currentSelection.classList.remove("selected");
            currentSelection = null;
        }
    }
});
</script>
</body>
</html>